<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezerwacja Terminów</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Nowa wersja EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const adminEmail = "projektweselelubuskie@gmail.com";

            // Konfiguracja Firebase
            const firebaseConfig = {
                apiKey: "API_KEY",
                authDomain: "projekt-rezerwacja.firebaseapp.com",
                projectId: "projekt-rezerwacja",
                storageBucket: "projekt-rezerwacja.appspot.com",
                messagingSenderId: "118180989579",
                appId: "1:118180989579:ios:b2d2961d5f8b4b1963628e"
            };

            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log("✅ Firebase załadowany poprawnie!");
            }

            const db = firebase.firestore();
            const availableTimesRef = db.collection("dostepne_terminy");

            async function loadAvailableTimes() {
                const dateSelect = document.getElementById("date");
                const timeSelect = document.getElementById("time");

                dateSelect.innerHTML = "<option value=''>Wybierz datę</option>";
                timeSelect.innerHTML = "<option value=''>Wybierz godzinę</option>";

                try {
                    const snapshot = await availableTimesRef.get();
                    if (snapshot.empty) {
                        console.warn("⚠ Brak dostępnych terminów w Firestore!");
                        dateSelect.innerHTML = "<option value=''>Brak terminów</option>";
                        return;
                    }

                    const dates = {};
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (!dates[data.date]) {
                            dates[data.date] = [];
                        }
                        dates[data.date].push(data.time);
                    });

                    Object.keys(dates).forEach(date => {
                        let option = document.createElement("option");
                        option.value = date;
                        option.textContent = date;
                        dateSelect.appendChild(option);
                    });

                    dateSelect.addEventListener("change", function() {
                        timeSelect.innerHTML = "<option value=''>Wybierz godzinę</option>";
                        const selectedDate = this.value;
                        if (dates[selectedDate]) {
                            dates[selectedDate].forEach(time => {
                                let option = document.createElement("option");
                                option.value = time;
                                option.textContent = time;
                                timeSelect.appendChild(option);
                            });
                        }
                    });

                } catch (error) {
                    console.error("❌ Błąd podczas pobierania terminów:", error);
                    dateSelect.innerHTML = "<option value=''>Błąd ładowania</option>";
                }
            }

            loadAvailableTimes();
        });
    </script>
</head>
<body>
    <header>
        <img src="https://www.projekt-wesele.pl/wp-content/uploads/2021/03/projekt-wesele-logo-01.png" alt="Projekt Wesele">
    </header>
    
    <div class="container">
        <h2>Rezerwacja Spotkania</h2>
        <form id="bookingForm">
            <label for="meetingType">Rodzaj spotkania:</label>
            <select id="meetingType" required>
                <option value="online">Online</option>
                <option value="biuro">W biurze (Zielona Góra)</option>
            </select>
            <label for="name">Imię i nazwisko:</label>
            <input type="text" id="name" required>
            <label for="email">E-mail:</label>
            <input type="email" id="email" required>
            <label for="weddingDate">Data wesela:</label>
            <input type="date" id="weddingDate" required>
            <label for="weddingPlace">Miejsce wesela:</label>
            <input type="text" id="weddingPlace" required>
            <label for="services">Usługodawcy:</label>
            <input type="text" id="services" placeholder="Wpisz usługodawców" required>
            <label for="message">Dodatkowa wiadomość:</label>
            <textarea id="message" placeholder="Wpisz dodatkowe informacje"></textarea>
            <label for="date">Data:</label>
            <input type="date" id="date" required>
            <label for="time">Godzina:</label>
            <input type="time" id="time" required>
            <button type="submit">Zarezerwuj</button>
        </form>
        <p id="confirmation" style="color:green; display:none;">Rezerwacja potwierdzona!</p>
    </div>
</body>
</html>
