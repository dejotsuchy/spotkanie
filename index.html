<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("âœ… Åadowanie Firebase...");

        // ðŸ”¥ Poprawna konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "TWOJ_POPRAWNY_KLUCZ_API",  // Wstaw poprawny klucz
            authDomain: "projekt-rezerwacja.firebaseapp.com",
            projectId: "projekt-rezerwacja",
            storageBucket: "projekt-rezerwacja.appspot.com",
            messagingSenderId: "118180989579",
            appId: "1:118180989579:web:dd3e4487c40d0b3863628e"
        };

        // âœ… Inicjalizacja Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log("âœ… Firebase zaÅ‚adowany poprawnie!");
        } else {
            console.log("ðŸ” Firebase juÅ¼ byÅ‚ zaÅ‚adowany.");
        }

        const db = firebase.firestore();
        const auth = firebase.auth();
        const adminEmail = "projektweselelubuskie@gmail.com";

        // ðŸ”¥ ObsÅ‚uga logowania
        document.getElementById("loginBtn").addEventListener("click", function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                console.log("âœ… Zalogowano:", result.user.email);
            }).catch((error) => {
                console.error("âŒ BÅ‚Ä…d logowania:", error);
            });
        });

        document.getElementById("logoutBtn").addEventListener("click", function() {
            auth.signOut().then(() => {
                console.log("âœ… Wylogowano");
            });
        });

        // ðŸ”¥ Sprawdzenie czy uÅ¼ytkownik to administrator
        auth.onAuthStateChanged((user) => {
            if (user && user.email === adminEmail) {
                document.getElementById("adminPanel").style.display = "block";
                document.getElementById("loginBtn").style.display = "none";
                document.getElementById("logoutBtn").style.display = "block";
            } else {
                document.getElementById("adminPanel").style.display = "none";
                document.getElementById("loginBtn").style.display = "block";
                document.getElementById("logoutBtn").style.display = "none";
            }
        });

        // ðŸ”¥ Pobieranie dostÄ™pnych terminÃ³w
        async function loadAvailableTimes() {
            const dateSelect = document.getElementById("date");
            const timeSelect = document.getElementById("time");
            dateSelect.innerHTML = "<option value=''>Wybierz datÄ™</option>";
            timeSelect.innerHTML = "<option value=''>Wybierz godzinÄ™</option>";

            const snapshot = await db.collection("dostepne_terminy").get();
            const dates = {};
            snapshot.forEach(doc => {
                const data = doc.data();
                if (!dates[data.date]) {
                    dates[data.date] = [];
                }
                dates[data.date].push(data.time);
            });

            Object.keys(dates).forEach(date => {
                let option = document.createElement("option");
                option.value = date;
                option.textContent = date;
                dateSelect.appendChild(option);
            });

            dateSelect.addEventListener("change", function() {
                timeSelect.innerHTML = "<option value=''>Wybierz godzinÄ™</option>";
                const selectedDate = this.value;
                if (dates[selectedDate]) {
                    dates[selectedDate].forEach(time => {
                        let option = document.createElement("option");
                        option.value = time;
                        option.textContent = time;
                        timeSelect.appendChild(option);
                    });
                }
            });
        }

        loadAvailableTimes();
    });
</script>
